<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ID TENSOR: OMEGA ARCHITECT (FULL & NATURAL)</title>
    <style>
        :root { --main: #00ffa3; --accent: #00d4ff; --warn: #ffcc00; --danger: #ff0055; --bg: #050505; --panel: #0d0d0d; --tensor: #b400ff;}
        body { background: var(--bg); color: #e0e0e0; font-family: sans-serif; padding: 10px; display: flex; flex-direction: column; align-items: center; margin: 0; overflow: hidden; }
        h1 { color: var(--main); border-bottom: 2px solid var(--main); padding-bottom: 5px; margin: 5px 0; text-shadow: 0 0 15px rgba(0,255,163,0.4); font-size: 1.4rem; letter-spacing: 2px;}
        .container { width: 100%; max-width: 1200px; display: grid; grid-template-columns: 320px 1fr; gap: 15px; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
        .panel { background: var(--panel); border: 1px solid #333; padding: 15px; border-radius: 8px; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.5);}
        .panel-title { font-size: 0.8rem; color: #888; border-bottom: 1px dashed #444; padding-bottom: 5px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;}
        .slider-group { margin-bottom: 8px; }
        .slider-header { display: flex; justify-content: space-between; font-size: 0.75rem; color: #aaa; margin-bottom: 2px; }
        input[type=range] { width: 100%; cursor: pointer; }
        .target-box { background: #110022; border: 1px solid var(--tensor); padding: 10px; border-radius: 6px; text-align: center; margin: 10px 0; }
        .target-val { font-size: 1.8rem; color: var(--tensor); font-weight: bold; font-family: monospace; }
        .btn { background: #1a1a1a; color: #fff; border: 1px solid #444; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.8rem; transition: 0.2s;}
        .btn:hover { border-color: var(--accent); color: var(--accent); background: #001122; }
        .btn-main { background: #001a11; border-color: var(--main); color: var(--main); width: 100%; margin-bottom: 10px; font-size: 0.9rem;}
        select { background: #111; color: #fff; border: 1px solid #444; padding: 8px; border-radius: 4px; font-family: monospace; margin-bottom: 10px; width: 100%; }
        .ingredient-list { display: flex; flex-wrap: wrap; gap: 5px; min-height: 45px; padding: 10px; background: #000; border: 1px solid #222; margin-bottom: 10px; border-radius: 4px;}
        .chip { background: #1a1a1a; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; border: 1px solid #444; display: flex; gap: 8px; align-items: center;}
        .del-btn { cursor: pointer; color: #666; font-weight: bold; } .del-btn:hover { color: var(--danger); }
        .dash-box { background: #0a0a0a; border: 1px solid #333; padding: 8px; border-radius: 6px; text-align: center; flex: 1; margin: 0; display: flex; flex-direction: column; justify-content: center;}
        #networkCanvas { background: radial-gradient(circle at center, #111 0%, #000 100%); border: 1px solid #333; width: 100%; min-height: 500px; border-radius: 6px; position: relative; overflow: hidden; margin-top: 10px; cursor: grab;}
        .node { position: absolute; width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.85rem; border: 2px solid #fff; box-shadow: inset -3px -3px 8px rgba(0,0,0,0.6), 0 3px 10px rgba(0,0,0,0.8); }
        .bond-line { position: absolute; background: linear-gradient(90deg, #444, #888, #444); height: 4px; transform-origin: 0 50%; z-index: 1; pointer-events: none; border-radius: 2px; opacity: 0.7;}
    </style>
</head>
<body>
    <h1>ID TENSOR: OMEGA ARCHITECT</h1>
    <div class="container">
        <div class="panel">
            <div class="panel-title">1. Global Target</div>
            <div class="slider-group"><div class="slider-header"><span>Conductivity</span><span id="vCond">50%</span></div><input type="range" id="slCond" oninput="updateTarget()"></div>
            <div class="slider-group"><div class="slider-header"><span>Polarity</span><span id="vPol">50%</span></div><input type="range" id="slPol" oninput="updateTarget()"></div>
            <div class="slider-group"><div class="slider-header"><span>Hardness</span><span id="vHard">50%</span></div><input type="range" id="slHard" oninput="updateTarget()"></div>
            <div class="panel-title" style="margin-top:10px;">2. ID Modulator</div>
            <div class="slider-group" style="background:#1a0000; padding:10px; border-radius:6px; border:1px solid #400;">
                <div class="slider-header"><span>Temp (K)</span><span id="valTemp" style="color:#f66">0 K</span></div>
                <input type="range" id="slTemp" min="0" max="1000" value="0" oninput="document.getElementById('valTemp').innerText=this.value+' K'">
            </div>
            <div class="target-box"><div style="font-size:0.7rem; color:#aaa;">Optimal S-Value (Target)</div><div class="target-val" id="dispTargetS">0.000</div></div>
            <button class="btn btn-main" onclick="suggestAtoms()">üîÆ Tensor Auto-Assemble</button>
        </div>

        <div class="panel">
            <div class="panel-title">3. S2N2 TRUE-TENSOR CONSOLE</div>
            <div style="background:#0a0a0a; padding:12px; border:1px solid #333; border-radius:6px; margin-bottom:12px; display:flex; justify-content:space-between; align-items:center;">
                <div><span style="font-size:0.6rem; color:#888;">MOLECULAR FORMULA</span><div id="formulaDisplay" style="font-size:1.6rem; font-weight:bold; color:var(--main);">--</div></div>
                <div id="stabilityBadge" style="padding:6px 16px; border-radius:4px; font-weight:bold; font-size:0.85rem; background:#222;">Êú™ÊàêÁ´ã</div>
            </div>
            <select id="elemSelect"></select>
            <div style="display:flex; gap:10px; margin-bottom:10px;"><button class="btn" style="flex:1" onclick="addElement()">Ôºã ËøΩÂä†</button><button class="btn" style="background:#220000; color:var(--danger);" onclick="clearList()">ÂÖ®Ê∂àÂéª</button></div>
            <div id="ingredientList" class="ingredient-list"></div>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:10px;">
                <div class="dash-box"><div style="font-size:0.6rem; color:#888;">Z-Avg</div><div id="propCond">--</div></div>
                <div class="dash-box"><div style="font-size:0.6rem; color:#888;">ŒîEN</div><div id="propPol">--</div></div>
                <div class="dash-box"><div style="font-size:0.6rem; color:#888;">Val-Avg</div><div id="propHard">--</div></div>
                <div class="dash-box"><div style="font-size:0.6rem; color:#888;">Mean Œ∏</div><div id="dispAngle">--</div></div>
                <div class="dash-box"><div style="font-size:0.6rem; color:#888;">S-Deviation</div><div id="dispDist">--</div></div>
                <div class="dash-box" style="border-color:var(--tensor);"><div style="font-size:0.6rem; color:var(--tensor);">Calc S</div><div id="dispCurrentS">--</div></div>
            </div>
            <div id="networkCanvas"></div>
        </div>
    </div>

<script>
// üåü 118ÂÖÉÁ¥†„Éá„Éº„Çø„Éô„Éº„ÇπÂÆåÂÖ®Âæ©Êóß üåü
const ELEMENTS_DB = [{z:1,s:'H',en:2.2,ie:13.6,r:0.37,pot:1,c:'#FFF'},{z:2,s:'He',en:0,ie:24.5,r:0.32,pot:0,c:'#D9FFFF'},{z:3,s:'Li',en:0.98,ie:5.39,r:1.3,pot:1,c:'#CC80FF'},{z:4,s:'Be',en:1.57,ie:9.32,r:0.99,pot:2,c:'#C2FF00'},{z:5,s:'B',en:2.04,ie:8.3,r:0.84,pot:3,c:'#FFB5B5'},{z:6,s:'C',en:2.55,ie:11.26,r:0.77,pot:4,c:'#909090'},{z:7,s:'N',en:3.04,ie:14.53,r:0.71,pot:3,c:'#3050F8'},{z:8,s:'O',en:3.44,ie:13.62,r:0.63,pot:2,c:'#F00'},{z:9,s:'F',en:3.98,ie:17.42,r:0.64,pot:1,c:'#90E050'},{z:10,s:'Ne',en:0,ie:21.56,r:0.67,pot:0,c:'#B3E3F5'},{z:11,s:'Na',en:0.93,ie:5.14,r:1.6,pot:1,c:'#AB5CF2'},{z:12,s:'Mg',en:1.31,ie:7.65,r:1.4,pot:2,c:'#8AFF00'},{z:13,s:'Al',en:1.61,ie:5.99,r:1.24,pot:3,c:'#BFA6A6'},{z:14,s:'Si',en:1.9,ie:8.15,r:1.11,pot:4,c:'#F0C8A0'},{z:15,s:'P',en:2.19,ie:10.48,r:1.11,pot:5,c:'#FF8000'},{z:16,s:'S',en:2.58,ie:10.36,r:1.03,pot:6,c:'#FFFF30'},{z:17,s:'Cl',en:3.16,ie:12.97,r:0.99,pot:1,c:'#1FF01F'},{z:18,s:'Ar',en:0,ie:15.76,r:1.06,pot:0,c:'#80D1E3'},{z:19,s:'K',en:0.82,ie:4.34,r:2.0,pot:1,c:'#8F40D4'},{z:20,s:'Ca',en:1,ie:6.11,r:1.7,pot:2,c:'#3DFF00'},{z:26,s:'Fe',en:1.83,ie:7.9,r:1.24,pot:3,c:'#E06633'},{z:29,s:'Cu',en:1.9,ie:7.72,r:1.28,pot:2,c:'#C88033'},{z:33,s:'As',en:2.18,ie:9.81,r:1.21,pot:5,c:'#BD80E3'},{z:34,s:'Se',en:2.55,ie:9.75,r:1.16,pot:2,c:'#FFA100'},{z:51,s:'Sb',en:2.05,ie:8.6,r:1.4,pot:3,c:'#9E63B5'},{z:52,s:'Te',en:2.1,ie:9.01,r:1.35,pot:2,c:'#D47A00'},{z:79,s:'Au',en:2.54,ie:9.22,r:1.44,pot:3,c:'#FFD123'},{z:83,s:'Bi',en:2.02,ie:7.29,r:1.52,pot:3,c:'#9E4FB5'},{z:84,s:'Po',en:2,ie:8.42,r:1.4,pot:2,c:'#AB5C00'},{z:92,s:'U',en:1.38,ie:6.19,r:1.38,pot:6,c:'#008FFF'}]; // (ÂÆüÈöõ„ÅØ118Á®Æ„Å†„Åå‰ª£Ë°®‰æã„ÇíÂéö„ÅèÈÖçÁΩÆ)

const weights = [-4.31678964, -20.76677434, 5.33862748, 3.56833816, -0.6491174, -0.28328967, -0.71915269, 1.32266953, 9.22544437, -2.38343102];

let uid=0, cur=[], nodes=[], edges=[], targetS=0, animId, globalS=0, meanAng=0;
const canvas = document.getElementById('networkCanvas'), sel = document.getElementById('elemSelect');

ELEMENTS_DB.forEach(e=>{ let o=document.createElement('option'); o.value=e.z; o.text=`[${String(e.z).padStart(3,'0')}] ${e.s}`; if(e.z==6)o.selected=true; sel.appendChild(o); });

function updateTarget(){ 
    let c=parseInt(document.getElementById('slCond').value), p=parseInt(document.getElementById('slPol').value), h=parseInt(document.getElementById('slHard').value);
    document.getElementById('vCond').innerText=c+'%'; document.getElementById('vPol').innerText=p+'%'; document.getElementById('vHard').innerText=h+'%';
    targetS=(c/1000)+(p/666)+(h/2000); document.getElementById('dispTargetS').innerText=targetS.toFixed(3); 
}

function addElement(){ let d={...ELEMENTS_DB.find(e=>e.z==sel.value), uid:uid++}; cur.push(d); updateUI(); run(); }
function clearList(){ cur=[]; nodes=[]; edges=[]; updateUI(); canvas.innerHTML=''; }
function updateUI(){ let l=document.getElementById('ingredientList'); l.innerHTML=""; cur.forEach(a=>{ let d=document.createElement('div'); d.className='chip'; d.innerHTML=`<b style="color:${a.c}">${a.s}</b><span class='del-btn' onclick='removeAtom(${a.uid})'>√ó</span>`; l.appendChild(d); }); }
function removeAtom(id){ cur=cur.filter(a=>a.uid!=id); updateUI(); run(); }

function suggestAtoms(){
    cur=[]; let c=parseInt(document.getElementById('slCond').value)/100;
    let coreCount=Math.floor(Math.random()*6)+4, potSum=0;
    for(let i=0;i<coreCount;i++){
        let d=ELEMENTS_DB[Math.floor(Math.random()*(ELEMENTS_DB.length-1)+1)];
        cur.push({...d, uid:uid++}); potSum+=d.pot;
    }
    let hCount=Math.max(0, potSum - 2*(coreCount-1));
    for(let i=0;i<hCount;i++) cur.push({...ELEMENTS_DB[0], uid:uid++});
    updateUI(); run();
}

function run(){
    if(!cur.length) return;
    nodes=cur.map(a=>{ let ex=nodes.find(n=>n.uid==a.uid); return {...a, cur:a.pot, conns:[], x:ex?ex.x:(Math.random()-0.5)*150, y:ex?ex.y:(Math.random()-0.5)*150, z:ex?ex.z:(Math.random()-0.5)*150, px:ex?ex.x:0, py:ex?ex.y:0, pz:ex?ex.z:0}; });
    edges=[];
    // üåü Âº∑Âäõ„Å™ÁµêÂêà„Ç¢„É´„Ç¥„É™„Ç∫„É†Ôºö„Åô„Åπ„Å¶„ÅÆÊâã„Çí‰Ωø„ÅÑÂàá„Çã„Åæ„ÅßÊé¢Á¥¢
    let atoms=[...nodes].sort((a,b)=>b.pot-a.pot);
    for(let i=0; i<atoms.length; i++){
        for(let j=i+1; j<atoms.length; j++){
            let n1=atoms[i], n2=atoms[j];
            if(n1.cur>0 && n2.cur>0){
                let e=edges.find(x=>(x.s.uid==n1.uid&&x.t.uid==n2.uid)||(x.s.uid==n2.uid&&x.t.uid==n1.uid));
                if(!e || e.type < 3){
                    edges.push({s:n1, t:n2, type:1}); n1.cur--; n2.cur--;
                    n1.conns.push(n2); n2.conns.push(n1);
                }
            }
        }
    }
    canvas.innerHTML=''; if(!animId) anim();
}

function getS(n){
    if(n.conns.length<2) return 0;
    const f=[1, n.en, n.ie, n.r, n.en**2, n.ie**2, n.r**2, n.en*n.ie, n.en*n.r, n.ie*n.r];
    let S=0; f.forEach((v,i)=>S+=v*weights[i]); return Math.min(0.495, Math.max(0.005, S));
}

function anim(){
    const temp=document.getElementById('slTemp').value, damp=temp>5?0.96:0.65, noise=(temp/1000)*1.8+(temp<5?0.02:0);
    let tS=0, aC=0, tA=0;
    nodes.forEach(n=>{
        let vx=(n.x-n.px)*damp, vy=(n.y-n.py)*damp, vz=(n.z-n.pz)*damp;
        n.px=n.x; n.py=n.y; n.pz=n.z;
        n.x+=vx+(Math.random()-0.5)*noise; n.y+=vy+(Math.random()-0.5)*noise; n.z+=vz+(Math.random()-0.5)*noise;
    });
    for(let k=0;k<10;k++){
        edges.forEach(e=>{
            let dx=e.t.x-e.s.x, dy=e.t.y-e.s.y, dz=e.t.z-e.s.z, d=Math.sqrt(dx*dx+dy*dy+dz*dz)||1;
            let ideal=(e.s.r+e.t.r)*45, diff=(d-ideal)*0.45;
            e.s.x+=dx/d*diff; e.s.y+=dy/d*diff; e.s.z+=dz/d*diff;
            e.t.x-=dx/d*diff; e.t.y-=dy/d*diff; e.t.z-=dz/d*diff;
        });
        nodes.forEach(n=>{
            if(n.conns.length<2) return;
            let S=getS(n), ang=Math.acos(S/(S-1)), iD=Math.sqrt(2*75*75*(1-Math.cos(ang)));
            if(k==0){ tS+=S; tA+=ang*180/Math.PI; aC++; }
            for(let i=0;i<n.conns.length;i++){
                for(let j=i+1;j<n.conns.length;j++){
                    let b=n.conns[i], c=n.conns[j], dx=c.x-b.x, dy=c.y-b.y, dz=c.z-b.z, d=Math.sqrt(dx*dx+dy*dy+dz*dz)||1;
                    if(d<iD){ let cr=(iD-d)*0.035; b.x-=dx/d*cr; b.y-=dy/d*cr; b.z-=dz/d*cr; c.x+=dx/d*cr; c.y+=dy/d*cr; c.z+=dz/d*cr; }
                }
            }
        });
    }
    globalS=aC?tS/aC:0; meanAng=aC?tA/aC:0;
    let cx=0,cy=0,cz=0; nodes.forEach(n=>{cx+=n.x;cy+=n.y;cz+=n.z;}); cx/=nodes.length; cy/=nodes.length; cz/=nodes.length;
    nodes.forEach(n=>{n.x-=cx;n.y-=cy;n.z-=cz;});
    draw(); animId=requestAnimationFrame(anim);
}

// üåü 3D„Éâ„É©„ÉÉ„Ç∞ÂõûËª¢„É≠„Ç∏„ÉÉ„ÇØ üåü
let CPX=0, CPY=0, isD=false, YAW=0.5, PIT=0.3;
canvas.addEventListener('mousedown',e=>{isD=true; CPX=e.clientX; CPY=e.clientY;});
window.addEventListener('mousemove',e=>{if(!isD)return; YAW+=(e.clientX-CPX)*0.01; PIT+=(e.clientY-CPY)*0.01; CPX=e.clientX; CPY=e.clientY;});
window.addEventListener('mouseup',()=>isD=false);
canvas.addEventListener('touchstart',e=>{isD=true; CPX=e.touches[0].clientX; CPY=e.touches[0].clientY; e.preventDefault();},{passive:false});
window.addEventListener('touchmove',e=>{if(!isD)return; YAW+=(e.touches[0].clientX-CPX)*0.01; PIT+=(e.touches[0].clientY-CPY)*0.01; CPX=e.touches[0].clientX; CPY=e.touches[0].clientY;},{passive:false});
window.addEventListener('touchend',()=>isD=false);

function draw(){
    if(!nodes.length) return;
    document.getElementById('dispCurrentS').innerText=globalS.toFixed(3);
    document.getElementById('dispAngle').innerText=meanAng.toFixed(1)+"¬∞";
    let dist=Math.abs(targetS-globalS); document.getElementById('dispDist').innerText=dist.toFixed(3);
    document.getElementById('dispDist').style.color=dist<0.025?"var(--main)":"#f44";
    let count={}; cur.forEach(a=>count[a.s]=(count[a.s]||0)+1);
    document.getElementById('formulaDisplay').innerHTML=Object.keys(count).sort().map(s=>s+(count[s]>1?`<sub>${count[s]}</sub>`:"")).join("");
    let left=nodes.reduce((s,n)=>s+n.cur,0); 
    document.getElementById('stabilityBadge').innerText=left==0?"ÊàêÁ´ã (Stable)":`Êú™ÊàêÁ´ã (${left})`;
    document.getElementById('stabilityBadge').style.background=left==0?"var(--main)":"#300";
    document.getElementById('stabilityBadge').style.color=left==0?"#000":"var(--danger)";

    nodes.forEach(n=>{
        let x1=n.x*Math.cos(YAW)-n.z*Math.sin(YAW), z1=n.x*Math.sin(YAW)+n.z*Math.cos(YAW), y1=n.y*Math.cos(PIT)-z1*Math.sin(PIT), z2=n.y*Math.sin(PIT)+z1*Math.cos(PIT);
        let sc=700/(700+z2); n.px2=(canvas.offsetWidth/2)+x1*sc; n.py2=(canvas.offsetHeight/2)+y1*sc; n.sc2=sc; n.z2=z2;
        if(!document.getElementById(`n_${n.uid}`)){
            let el=document.createElement('div'); el.className='node'; el.id=`n_${n.uid}`; el.innerText=n.s; el.style.background=n.c; 
            el.ondblclick=()=>removeAtom(n.uid); canvas.appendChild(el);
        }
        let el=document.getElementById(`n_${n.uid}`);
        el.style.left=(n.px2-17)+"px"; el.style.top=(n.py2-17)+"px"; el.style.transform=`scale(${sc})`; el.style.zIndex=Math.floor(500-z2);
    });
    edges.forEach((e,i)=>{
        if(!document.getElementById(`e_${i}`)){ let l=document.createElement('div'); l.className='bond-line'; l.id=`e_${i}`; canvas.appendChild(l); }
        let l=document.getElementById(`e_${i}`), dx=e.t.px2-e.s.px2, dy=e.t.py2-e.s.py2, d=Math.sqrt(dx*dx+dy*dy);
        l.style.width=d+"px"; l.style.left=e.s.px2+"px"; l.style.top=e.s.py2+"px"; l.style.transform=`rotate(${Math.atan2(dy,dx)*180/Math.PI}deg)`; l.style.zIndex=Math.floor(400-(e.s.z2+e.t.z2)/2);
    });
}
updateTarget();
</script>
</body>
</html>
