<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ID TENSOR: OMEGA ARCHITECT (FINAL)</title>
    <style>
        :root { --main: #00ffa3; --accent: #00d4ff; --warn: #ffcc00; --danger: #ff0055; --bg: #050505; --panel: #0d0d0d; --tensor: #b400ff;}
        body { background: var(--bg); color: #e0e0e0; font-family: sans-serif; padding: 10px; display: flex; flex-direction: column; align-items: center; margin: 0; overflow-y: auto; overflow-x: hidden; }
        h1 { color: var(--main); border-bottom: 2px solid var(--main); padding: 5px 0; margin: 5px 0; text-shadow: 0 0 15px rgba(0,255,163,0.4); font-size: 1.3rem; letter-spacing: 2px;}
        .container { width: 100%; max-width: 1200px; display: grid; grid-template-columns: 320px 1fr; gap: 15px; margin-bottom: 60px; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
        .panel { background: var(--panel); border: 1px solid #333; padding: 15px; border-radius: 8px; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.5);}
        .panel-title { font-size: 0.75rem; color: #888; border-bottom: 1px dashed #444; padding-bottom: 5px; margin-bottom: 10px; text-transform: uppercase;}
        input[type=range] { width: 100%; cursor: pointer; }
        .btn { background: #1a1a1a; color: #fff; border: 1px solid #444; padding: 8px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.8rem; transition: 0.2s;}
        .btn-main { background: #001a11; border-color: var(--main); color: var(--main); width: 100%; margin-bottom: 10px; font-size: 0.9rem;}
        select { background: #111; color: #fff; border: 1px solid #444; padding: 8px; border-radius: 4px; width: 100%; margin-bottom: 10px;}
        .ingredient-list { display: flex; flex-wrap: wrap; gap: 5px; min-height: 45px; padding: 10px; background: #000; border: 1px solid #222; margin-bottom: 10px; border-radius: 4px;}
        .chip { background: #1a1a1a; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; border: 1px solid #444; display: flex; gap: 8px;}
        .dash-box { background: #0a0a0a; border: 1px solid #333; padding: 8px; border-radius: 6px; text-align: center; flex: 1;}
        #networkCanvas { background: radial-gradient(circle at center, #111 0%, #000 100%); border: 1px solid #333; width: 100%; min-height: 550px; border-radius: 6px; position: relative; overflow: hidden; margin-top: 10px; touch-action: none; cursor: grab;}
        .node { position: absolute; width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; border: 2px solid #fff; box-shadow: inset -3px -3px 8px rgba(0,0,0,0.6); pointer-events: none;}
        .bond-line { position: absolute; height: 4px; transform-origin: 0 50%; z-index: 1; pointer-events: none; opacity: 0.6; border-radius: 2px;}
    </style>
</head>
<body>
    <h1>ID TENSOR: OMEGA ARCHITECT</h1>
    <div class="container">
        <div class="panel">
            <div class="panel-title">1. Global Target</div>
            <input type="range" id="slCond" oninput="updateTarget()">
            <input type="range" id="slPol" oninput="updateTarget()">
            <input type="range" id="slHard" oninput="updateTarget()">
            <div class="panel-title" style="margin-top:10px;">2. ID Modulator</div>
            <input type="range" id="slTemp" min="0" max="1000" value="0" oninput="document.getElementById('vT').innerText=this.value+' K'">
            <div id="vT" style="text-align:center; color:#f66;">0 K</div>
            <div style="background:#110022; border:1px solid var(--tensor); padding:10px; border-radius:6px; text-align:center; margin:10px 0;">
                <div style="font-size:0.6rem; color:#aaa;">Target S-Value</div>
                <div id="dispTargetS" style="font-size:1.8rem; color:var(--tensor); font-weight:bold;">0.000</div>
            </div>
            <button class="btn btn-main" onclick="oracleSet()">ğŸ”® Oracle Auto-Assemble</button>
        </div>

        <div class="panel">
            <div class="panel-title">3. S2N2 PHYSICS CONSOLE</div>
            <div style="background:#0a0a0a; padding:12px; border:1px solid #333; border-radius:6px; margin-bottom:12px; display:flex; justify-content:space-between;">
                <div><span style="font-size:0.6rem; color:#888;">FORMULA</span><div id="formulaDisplay" style="font-size:1.5rem; font-weight:bold; color:var(--main);">--</div></div>
                <div id="stabilityBadge" style="padding:6px 12px; border-radius:4px; font-weight:bold; font-size:0.8rem; background:#222;">æœªæˆç«‹</div>
            </div>
            <select id="elemSelect"></select>
            <div style="display:flex; gap:10px; margin-bottom:10px;"><button class="btn" style="flex:1" onclick="addElement()">ï¼‹ è¿½åŠ </button><button class="btn" style="background:#300;" onclick="clearList()">å…¨æ¶ˆå»</button></div>
            <div id="ingredientList" class="ingredient-list"></div>
            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:8px;">
                <div class="dash-box"><div style="font-size:0.5rem; color:#888;">Z-Avg</div><div id="propCond">--</div></div>
                <div class="dash-box"><div style="font-size:0.5rem; color:#888;">Î”EN</div><div id="propPol">--</div></div>
                <div class="dash-box"><div style="font-size:0.5rem; color:#888;">Hardness</div><div id="propHard">--</div></div>
                <div class="dash-box"><div style="font-size:0.5rem; color:#888;">Mean Î¸</div><div id="dispAngle">--</div></div>
                <div class="dash-box"><div style="font-size:0.5rem; color:#888;">S-Deviation</div><div id="dispDist">--</div></div>
                <div class="dash-box" style="border-color:var(--tensor);"><div style="font-size:0.5rem; color:var(--tensor);">Calc S</div><div id="dispCurrentS">--</div></div>
            </div>
            <div id="networkCanvas"></div>
        </div>
    </div>

<script>
// ğŸŒŸ S2N2 TRUE-DATABASE ğŸŒŸ
const DB = [
    {z:1,s:'H',en:2.2,ie:13.6,r:0.37,pot:1,c:'#FFF'},
    {z:6,s:'C',en:2.55,ie:11.26,r:0.77,pot:4,c:'#909090'},
    {z:7,s:'N',en:3.04,ie:14.53,r:0.71,pot:3,c:'#3050F8'},
    {z:8,s:'O',en:3.44,ie:13.62,r:0.63,pot:2,c:'#F00'},
    {z:14,s:'Si',en:1.9,ie:8.15,r:1.11,pot:4,c:'#FCA'},
    {z:15,s:'P',en:2.19,ie:10.48,r:1.11,pot:5,c:'#F80'},
    {z:16,s:'S',en:2.58,ie:10.36,r:1.03,pot:6,c:'#FF3'},
    {z:26,s:'Fe',en:1.83,ie:7.90,r:1.24,pot:3,c:'#E63'},
    {z:29,s:'Cu',en:1.9,ie:7.72,r:1.28,pot:2,c:'#C83'},
    {z:33,s:'As',en:2.18,ie:9.81,r:1.21,pot:5,c:'#B8E'},
    {z:83,s:'Bi',en:2.02,ie:7.29,r:1.52,pot:3,c:'#94B'}
];
// ğŸ‘‘ PDFã‚ˆã‚ŠæŠ½å‡ºï¼š10æ¬¡å…ƒãƒ†ãƒ³ã‚½ãƒ«é‡ã¿ãƒ™ã‚¯ãƒˆãƒ« ğŸ‘‘
const weights = [-4.31678964, -20.76677434, 5.33862748, 3.56833816, -0.6491174, -0.28328967, -0.71915269, 1.32266953, 9.22544437, -2.38343102];

let uid=0, curAtoms=[], nodes=[], edges=[], targetS=0, animId, gS=0, gA=0;
const canvas = document.getElementById('networkCanvas'), sel = document.getElementById('elemSelect');
DB.forEach(e=>{ let o=document.createElement('option'); o.value=e.z; o.text=`[${String(e.z).padStart(3,'0')}] ${e.s}`; if(e.z===6) o.selected=true; sel.appendChild(o); });

function updateTarget(){ 
    let c=slCond.value/100, p=slPol.value/100, h=slHard.value/100;
    targetS=(c*0.1)+(p*0.15)+(h*0.05); dispTargetS.innerText=targetS.toFixed(3); 
}

function addElement(){ curAtoms.push({...DB.find(e=>e.z==sel.value), id:uid++}); updateUI(); rebuild(); }
function clearList(){ curAtoms=[]; nodes=[]; edges=[]; updateUI(); canvas.innerHTML=''; }
function removeAt(id){ curAtoms=curAtoms.filter(a=>a.id!==id); updateUI(); rebuild(); }
function updateUI(){ ingredientList.innerHTML=""; curAtoms.forEach(a=>{ let d=document.createElement('div'); d.className='chip'; d.innerHTML=`<b style="color:${a.c}">${a.s}</b><span style="cursor:pointer;margin-left:5px;" onclick='removeAt(${a.id})'>Ã—</span>`; ingredientList.appendChild(d); }); }

// ğŸ‘‘ ORACLE: è«–ç†çš„ã‚¢ã‚»ãƒ³ãƒ–ãƒª (Ring-Frame First) ğŸ‘‘
function oracleSet(){
    curAtoms=[];
    let cCount=10, oCount=6; // å¸ä»¤å®˜ã® O6C10
    // ç‚­ç´ ç’°ã‚’ç”Ÿæˆ
    for(let i=0;i<cCount;i++) curAtoms.push({...DB.find(e=>e.z==6), id:uid++, ox:Math.cos(i/cCount*Math.PI*2)*80, oy:Math.sin(i/cCount*Math.PI*2)*80});
    // é…¸ç´ ã‚’æ¥ç¶šï¼ˆåˆ†æ•£é…ç½®ï¼‰
    for(let i=0;i<oCount;i++) {
        let angle = i/oCount*Math.PI*2;
        curAtoms.push({...DB.find(e=>e.z==8), id:uid++, ox:Math.cos(angle)*130, oy:Math.sin(angle)*130});
    }
    updateUI(); rebuild();
}

function rebuild(){
    if(!curAtoms.length) return;
    nodes = curAtoms.map(a=>{ 
        let ex=nodes.find(n=>n.id==a.id);
        return {...a, rem:a.pot, conns:[], x:a.ox||(Math.random()-0.5)*100, y:a.oy||(Math.random()-0.5)*100, z:(Math.random()-0.5)*50, px:0, py:0, pz:0}; 
    });
    edges = [];
    // è…•ï¼ˆä¾¡é›»å­ï¼‰ã‚’è«–ç†çš„ã«ä½¿ã„åˆ‡ã‚‹çµåˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
    let pools = [...nodes].sort((a,b)=>b.pot-a.pot); 
    for(let i=0; i<pools.length; i++){
        for(let j=i+1; j<pools.length; j++){
            let n1=pools[i], n2=pools[j];
            if(n1.rem > 0 && n2.rem > 0){
                let d = Math.sqrt((n1.x-n2.x)**2 + (n1.y-n2.y)**2);
                if(d < 150) { // ç‰©ç†çš„ã«è¿‘ã„ã‚‚ã®åŒå£«ã‚’å„ªå…ˆçµåˆ
                    edges.push({s:n1, t:n2}); n1.rem--; n2.rem--;
                    n1.conns.push(n2); n2.conns.push(n1);
                }
            }
        }
    }
    canvas.innerHTML=''; if(!animId) anim();
}

function getS(n){
    if(n.conns.length<2) return 0;
    const f=[1, n.en, n.ie, n.r, n.en**2, n.ie**2, n.r**2, n.en*n.ie, n.en*n.r, n.ie*n.r];
    let S=0; f.forEach((v,i)=>S+=v*weights[i]); return Math.min(0.495, Math.max(0.005, S));
}

function anim(){
    const temp=slTemp.value, damp=temp>5?0.95:0.75, noise=(temp/1000)*1.5;
    let tS=0, tA=0, aC=0;
    nodes.forEach(n=>{
        let vx=(n.x-n.px)*damp, vy=(n.y-n.py)*damp, vz=(n.z-n.pz)*damp;
        n.px=n.x; n.py=n.y; n.pz=n.z;
        n.x+=vx+(Math.random()-0.5)*noise; n.y+=vy+(Math.random()-0.5)*noise; n.z+=vz+(Math.random()-0.5)*noise;
    });
    // ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
    for(let k=0;k<12;k++){
        edges.forEach(e=>{
            let dx=e.t.x-e.s.x, dy=e.t.y-e.s.y, dz=e.t.z-e.s.z, d=Math.sqrt(dx*dx+dy*dy+dz*dz)||1;
            let ideal=(e.s.r+e.t.r)*55, diff=(d-ideal)*0.4;
            e.s.x+=dx/d*diff; e.s.y+=dy/d*diff; e.s.z+=dz/d*diff;
            e.t.x-=dx/d*diff; e.t.y-=dy/d*diff; e.t.z-=dz/d*diff;
        });
        nodes.forEach(n=>{
            if(n.conns.length<2) return;
            let S=getS(n), ang=Math.acos(S/(S-1)), iD=Math.sqrt(2*80*80*(1-Math.cos(ang)));
            if(k==0){ tS+=S; tA+=ang*180/Math.PI; aC++; }
            for(let i=0;i<n.conns.length;i++){
                for(let j=i+1;j<n.conns.length;j++){
                    let b=n.conns[i], c=n.conns[j], dx=c.x-b.x, dy=c.y-b.y, dz=c.z-b.z, d=Math.sqrt(dx*dx+dy*dy+dz*dz)||1;
                    if(d<iD){ let cr=(iD-d)*0.04; b.x-=dx/d*cr; b.y-=dy/d*cr; b.z-=dz/d*cr; c.x+=dx/d*cr; c.y+=dy/d*cr; c.z+=dz/d*cr; }
                }
            }
        });
    }
    gS=aC?tS/aC:0; gA=aC?tA/aC:0;
    // ğŸŒŸ è§’é‹å‹•é‡ãƒ­ãƒƒã‚¯: é‡å¿ƒã‚’å›ºå®šã—ã€å‹æ‰‹ãªå›è»¢ã‚’æ‰“ã¡æ¶ˆã™ ğŸŒŸ
    let cx=0,cy=0,cz=0; nodes.forEach(n=>{cx+=n.x;cy+=n.y;cz+=n.z;}); cx/=nodes.length; cy/=nodes.length; cz/=nodes.length;
    nodes.forEach(n=>{n.x-=cx;n.y-=cy;n.z-=cz;});
    
    draw(); animId=requestAnimationFrame(anim);
}

// ğŸŒŸ 3Dãƒ‰ãƒ©ãƒƒã‚°ï¼†iPadã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ ğŸŒŸ
let YAW=0.6, PIT=0.4, isD=false, CPX, CPY;
canvas.addEventListener('mousedown',e=>{isD=true; CPX=e.clientX; CPY=e.clientY;});
window.addEventListener('mousemove',e=>{if(!isD)return; YAW+=(e.clientX-CPX)*0.01; PIT+=(e.clientY-CPY)*0.01; CPX=e.clientX; CPY=e.clientY;});
window.addEventListener('mouseup',()=>isD=false);
canvas.addEventListener('touchstart',e=>{isD=true; CPX=e.touches[0].clientX; CPY=e.touches[0].clientY;},{passive:true});
window.addEventListener('touchmove',e=>{if(!isD)return; YAW+=(e.touches[0].clientX-CPX)*0.01; PIT+=(e.touches[0].clientY-CPY)*0.01; CPX=e.touches[0].clientX; CPY=e.touches[0].clientY; if(e.target==canvas) e.preventDefault();},{passive:false});
window.addEventListener('touchend',()=>isD=false);

function draw(){
    if(!nodes.length) return;
    dispCurrentS.innerText=gS.toFixed(3); dispAngle.innerText=gA.toFixed(1)+"Â°";
    let dist=Math.abs(targetS-gS); dispDist.innerText=dist.toFixed(3);
    dispDist.style.color=dist<0.025?"var(--main)":"#f44";
    let count={}; curAtoms.forEach(a=>count[a.s]=(count[a.s]||0)+1);
    formulaDisplay.innerHTML=Object.keys(count).sort().map(s=>s+(count[s]>1?`<sub>${count[s]}</sub>`:"")).join("");
    let rem=nodes.reduce((s,n)=>s+n.rem,0); stabilityBadge.innerText=rem==0?"æˆç«‹ (Stable)":`æœªæˆç«‹ (${rem})`;
    stabilityBadge.style.background=rem==0?"var(--main)":"#300"; stabilityBadge.style.color=rem==0?"#000":"var(--danger)";

    nodes.forEach(n=>{
        let x1=n.x*Math.cos(YAW)-n.z*Math.sin(YAW), z1=n.x*Math.sin(YAW)+n.z*Math.cos(YAW), y1=n.y*Math.cos(PIT)-z1*Math.sin(PIT), z2=n.y*Math.sin(PIT)+z1*Math.cos(PIT);
        let sc=750/(750+z2); n.px2=(canvas.offsetWidth/2)+x1*sc; n.py2=(canvas.offsetHeight/2)+y1*sc;
        if(!document.getElementById(`n_${n.id}`)){
            let el=document.createElement('div'); el.className='node'; el.id=`n_${n.id}`; el.innerText=n.s; el.style.background=n.c; canvas.appendChild(el);
        }
        let el=document.getElementById(`n_${n.id}`); el.style.left=(n.px2-17)+"px"; el.style.top=(n.py2-17)+"px"; el.style.transform=`scale(${sc})`; el.style.zIndex=Math.floor(1000-z2);
    });
    edges.forEach((e,i)=>{
        if(!document.getElementById(`e_${i}`)){ let l=document.createElement('div'); l.className='bond-line'; l.id=`e_${i}`; canvas.appendChild(l); }
        let l=document.getElementById(`e_${i}`), dx=e.t.px2-e.s.px2, dy=e.t.py2-e.s.py2, d=Math.sqrt(dx*dx+dy*dy);
        l.style.width=d+"px"; l.style.left=e.s.px2+"px"; l.style.top=e.s.py2+"px"; l.style.transform=`rotate(${Math.atan2(dy,dx)*180/Math.PI}deg)`; l.style.background="linear-gradient(90deg, #444, #888, #444)";
    });
}
updateTarget();
</script>
</body>
</html>
